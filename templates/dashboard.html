<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–≤—É—â–∏–π –∫–æ—Ç—ë–Ω–æ–∫ üê± –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <!-- –®–∞–ø–∫–∞ -->
        <header>
            <h1>üê± –†–µ–≤—É—â–∏–π –∫–æ—Ç—ë–Ω–æ–∫ - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h1>
        </header>

        <!-- –ë–ª–æ–∫: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –º–µ—Å—è—Ü -->
        <section class="month-stats">
            <div class="section-header">
                <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ {{ month_name }}</h2>
                <div class="month-selector">
                    <label for="month-select">–í—ã–±—Ä–∞—Ç—å –º–µ—Å—è—Ü:</label>
                    <select id="month-select" onchange="changeMonth(this.value)">
                        {% for m in months_list %}
                        <option value="{{ m.year }}-{{ m.month }}" 
                                {% if m.year == year and m.month == month %}selected{% endif %}>
                            {{ m.label }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            
            <div class="stats-cards">
                <div class="stat-card">
                    <div class="stat-value">{{ monthly_stats.total_trades }}</div>
                    <div class="stat-label">–í—Å–µ–≥–æ —Å–¥–µ–ª–æ–∫</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">{{ monthly_stats.profitable }}</div>
                    <div class="stat-label">–ü—Ä–∏–±—ã–ª—å–Ω—ã—Ö</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">{{ monthly_stats.unprofitable }}</div>
                    <div class="stat-label">–£–±—ã—Ç–æ—á–Ω—ã—Ö</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">{{ "%.2f"|format(monthly_stats.winrate) }}%</div>
                    <div class="stat-label">–í–∏–Ω—Ä–µ–π—Ç</div>
                </div>
                <div class="stat-card {% if monthly_stats.total_profit > 0 %}positive{% else %}negative{% endif %}">
                    <div class="stat-value">
                        {% if monthly_stats.total_profit > 0 %}+{% endif %}{{ "%.2f"|format(monthly_stats.total_profit) }}%
                    </div>
                    <div class="stat-label">–û–±—â–∞—è –ø—Ä–∏–±—ã–ª—å</div>
                </div>
            </div>
        </section>

        <!-- –ë–ª–æ–∫: –û—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ–∑–∏—Ü–∏–∏ -->
        {% if open_positions %}
        <section class="open-positions">
            <h2>üü¢ –û—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ–∑–∏—Ü–∏–∏</h2>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>–ê–∫—Ü–∏—è</th>
                            <th>–¶–µ–Ω–∞ –≤—Ö–æ–¥–∞</th>
                            <th>–î–∞—Ç–∞ –≤—Ö–æ–¥–∞</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for pos in open_positions %}
                        <tr>
                            <td>{{ pos.stock_emoji }} {{ pos.ticker }} - {{ pos.stock_name }}</td>
                            <td>{{ "%.2f"|format(pos.entry_price) }} ‚ÇΩ</td>
                            <td>{{ pos.entry_time.strftime("%d.%m.%Y %H:%M") }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>
        {% endif %}

        <!-- –ë–ª–æ–∫: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∞–∫—Ü–∏—è–º -->
        {% if ticker_stats %}
        <section class="ticker-stats">
            <h2>üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∞–∫—Ü–∏—è–º (–∑–∞ –≤—Å—ë –≤—Ä–µ–º—è)</h2>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>–ê–∫—Ü–∏—è</th>
                            <th>–°–¥–µ–ª–æ–∫</th>
                            <th>–í–∏–Ω—Ä–µ–π—Ç</th>
                            <th>–û–±—â–∞—è –ø—Ä–∏–±—ã–ª—å</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for stat in ticker_stats %}
                        <tr>
                            <td>{{ stat.stock_emoji }} {{ stat.ticker }} - {{ stat.stock_name }}</td>
                            <td>{{ stat.total_trades }}</td>
                            <td>{{ "%.2f"|format(stat.winrate) }}%</td>
                            <td class="{% if stat.total_profit > 0 %}positive{% else %}negative{% endif %}">
                                {% if stat.total_profit > 0 %}+{% endif %}{{ "%.2f"|format(stat.total_profit) }}%
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>
        {% endif %}

        <!-- –ë–ª–æ–∫: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ -->
        <section class="additional-stats">
            <h2>üíé –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ (–∑–∞ –≤—Å—ë –≤—Ä–µ–º—è)</h2>
            <div class="additional-cards">
                {% if best_trade %}
                <div class="additional-card">
                    <div class="card-title">üèÜ –õ—É—á—à–∞—è —Å–¥–µ–ª–∫–∞</div>
                    <div class="card-content">
                        <div class="card-main">{{ best_trade.stock_emoji }} {{ best_trade.ticker }}</div>
                        <div class="card-profit positive">+{{ "%.2f"|format(best_trade.profit_percent) }}%</div>
                        <div class="card-date">{{ best_trade.exit_time.strftime("%d.%m.%Y") }}</div>
                    </div>
                </div>
                {% endif %}

                {% if worst_trade %}
                <div class="additional-card">
                    <div class="card-title">üìâ –•—É–¥—à–∞—è —Å–¥–µ–ª–∫–∞</div>
                    <div class="card-content">
                        <div class="card-main">{{ worst_trade.stock_emoji }} {{ worst_trade.ticker }}</div>
                        <div class="card-profit negative">{{ "%.2f"|format(worst_trade.profit_percent) }}%</div>
                        <div class="card-date">{{ worst_trade.exit_time.strftime("%d.%m.%Y") }}</div>
                    </div>
                </div>
                {% endif %}

                <div class="additional-card">
                    <div class="card-title">‚è±Ô∏è –°—Ä–µ–¥–Ω—è—è –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</div>
                    <div class="card-content">
                        <div class="card-main-large">{{ avg_duration }}</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- –ë–ª–æ–∫: –õ–µ–Ω—Ç–∞ –≤—Å–µ—Ö —Å–¥–µ–ª–æ–∫ -->
        {% if closed_positions %}
        <section class="trades-feed">
            <h2>üìú –õ–µ–Ω—Ç–∞ —Å–¥–µ–ª–æ–∫ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ {{ closed_positions|length }})</h2>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>–î–∞—Ç–∞ –∑–∞–∫—Ä—ã—Ç–∏—è</th>
                            <th>–ê–∫—Ü–∏—è</th>
                            <th>–ü—Ä–∏–±—ã–ª—å</th>
                            <th>–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for pos in closed_positions %}
                        <tr>
                            <td>{{ pos.exit_time.strftime("%d.%m.%Y %H:%M") }}</td>
                            <td>{{ pos.stock_emoji }} {{ pos.ticker }} - {{ pos.stock_name }}</td>
                            <td class="{% if pos.profit_percent > 0 %}positive{% else %}negative{% endif %}">
                                {% if pos.profit_percent > 0 %}+{% endif %}{{ "%.2f"|format(pos.profit_percent) }}%
                            </td>
                            <td>{{ pos.duration_str }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>
        {% else %}
        <section class="trades-feed">
            <h2>üìú –õ–µ–Ω—Ç–∞ —Å–¥–µ–ª–æ–∫</h2>
            <p class="no-data">–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫—Ä—ã—Ç—ã—Ö —Å–¥–µ–ª–æ–∫</p>
        </section>
        {% endif %}

        <footer>
            <p>¬© 2025 –†–µ–≤—É—â–∏–π –∫–æ—Ç—ë–Ω–æ–∫ üê± | –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</p>
        </footer>
    </div>

    <script>
        function changeMonth(value) {
            const [year, month] = value.split('-');
            window.location.href = `/?year=${year}&month=${month}`;
        }
    </script>
</body>
</html>
