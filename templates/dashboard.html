<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–≤—É—â–∏–π –∫–æ—Ç—ë–Ω–æ–∫ üê± –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <!-- –®–∞–ø–∫–∞ -->
        <header>
            <h1>üê± –†–µ–≤—É—â–∏–π –∫–æ—Ç—ë–Ω–æ–∫ - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h1>
        </header>

        <!-- –ë–ª–æ–∫: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –º–µ—Å—è—Ü - –û–±—â–∞—è -->
        <section class="month-stats">
            <div class="section-header">
                <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ {{ month_name }} (–í—Å–µ)</h2>
                <div class="month-selector">
                    <label for="month-select">–í—ã–±—Ä–∞—Ç—å –º–µ—Å—è—Ü:</label>
                    <select id="month-select" onchange="changeMonth(this.value)">
                        {% for m in months_list %}
                        <option value="{{ m.year }}-{{ m.month }}" 
                                {% if m.year == year and m.month == month %}selected{% endif %}>
                            {{ m.label }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            
            <div class="stats-cards">
                <div class="stat-card">
                    <div class="stat-value">{{ monthly_stats_all.total_trades }}</div>
                    <div class="stat-label">–í—Å–µ–≥–æ —Å–¥–µ–ª–æ–∫</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">{{ monthly_stats_all.profitable }}</div>
                    <div class="stat-label">–ü—Ä–∏–±—ã–ª—å–Ω—ã—Ö</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">{{ monthly_stats_all.unprofitable }}</div>
                    <div class="stat-label">–£–±—ã—Ç–æ—á–Ω—ã—Ö</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">{{ "%.2f"|format(monthly_stats_all.winrate) }}%</div>
                    <div class="stat-label">–í–∏–Ω—Ä–µ–π—Ç</div>
                </div>
                <div class="stat-card {% if monthly_stats_all.total_profit > 0 %}positive{% else %}negative{% endif %}">
                    <div class="stat-value">
                        {% if monthly_stats_all.total_profit > 0 %}+{% endif %}{{ "%.2f"|format(monthly_stats_all.total_profit) }}%
                    </div>
                    <div class="stat-label">–û–±—â–∞—è –ø—Ä–∏–±—ã–ª—å</div>
                </div>
            </div>
        </section>

        <!-- –ë–ª–æ–∫: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ LONG -->
        <section class="month-stats">
            <h2>‚ÜóÔ∏è –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ LONG –∑–∞ {{ month_name }}</h2>
            <div class="stats-cards">
                <div class="stat-card long-card">
                    <div class="stat-value">{{ monthly_stats_long.total_trades }}</div>
                    <div class="stat-label">–í—Å–µ–≥–æ LONG</div>
                </div>
                <div class="stat-card long-card">
                    <div class="stat-value">{{ monthly_stats_long.profitable }}</div>
                    <div class="stat-label">–ü—Ä–∏–±—ã–ª—å–Ω—ã—Ö</div>
                </div>
                <div class="stat-card long-card">
                    <div class="stat-value">{{ "%.2f"|format(monthly_stats_long.winrate) }}%</div>
                    <div class="stat-label">–í–∏–Ω—Ä–µ–π—Ç LONG</div>
                </div>
                <div class="stat-card long-card {% if monthly_stats_long.total_profit > 0 %}positive{% else %}negative{% endif %}">
                    <div class="stat-value">
                        {% if monthly_stats_long.total_profit > 0 %}+{% endif %}{{ "%.2f"|format(monthly_stats_long.total_profit) }}%
                    </div>
                    <div class="stat-label">–ü—Ä–∏–±—ã–ª—å LONG</div>
                </div>
            </div>
        </section>

        <!-- –ë–ª–æ–∫: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ SHORT -->
        <section class="month-stats">
            <h2>‚ÜòÔ∏è –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ SHORT –∑–∞ {{ month_name }}</h2>
            <div class="stats-cards">
                <div class="stat-card short-card">
                    <div class="stat-value">{{ monthly_stats_short.total_trades }}</div>
                    <div class="stat-label">–í—Å–µ–≥–æ SHORT</div>
                </div>
                <div class="stat-card short-card">
                    <div class="stat-value">{{ monthly_stats_short.profitable }}</div>
                    <div class="stat-label">–ü—Ä–∏–±—ã–ª—å–Ω—ã—Ö</div>
                </div>
                <div class="stat-card short-card">
                    <div class="stat-value">{{ "%.2f"|format(monthly_stats_short.winrate) }}%</div>
                    <div class="stat-label">–í–∏–Ω—Ä–µ–π—Ç SHORT</div>
                </div>
                <div class="stat-card short-card {% if monthly_stats_short.total_profit > 0 %}positive{% else %}negative{% endif %}">
                    <div class="stat-value">
                        {% if monthly_stats_short.total_profit > 0 %}+{% endif %}{{ "%.2f"|format(monthly_stats_short.total_profit) }}%
                    </div>
                    <div class="stat-label">–ü—Ä–∏–±—ã–ª—å SHORT</div>
                </div>
            </div>
        </section>

        <!-- –ë–ª–æ–∫: –û—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ–∑–∏—Ü–∏–∏ -->
        {% if open_positions %}
        <section class="open-positions">
            <h2>üü¢ –û—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ–∑–∏—Ü–∏–∏</h2>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>–ê–∫—Ü–∏—è</th>
                            <th>–¢–∏–ø</th>
                            <th>–¶–µ–Ω–∞ –≤—Ö–æ–¥–∞</th>
                            <th>–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞</th>
                            <th>–ü—Ä–∏–±—ã–ª—å</th>
                            <th>–î–∞—Ç–∞ –≤—Ö–æ–¥–∞</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for pos in open_positions %}
                        <tr class="{% if pos.position_type == 'LONG' %}position-long{% else %}position-short{% endif %}">
                            <td>{{ pos.stock_emoji }} {{ pos.ticker }} - {{ pos.stock_name }}</td>
                            <td>
                                {% if pos.position_type == 'LONG' %}
                                    <span class="type-badge long-badge">‚ÜóÔ∏è LONG</span>
                                {% else %}
                                    <span class="type-badge short-badge">‚ÜòÔ∏è SHORT</span>
                                {% endif %}
                            </td>
                            <td>{{ "%.2f"|format(pos.entry_price) }} ‚ÇΩ</td>
                            <td>
                                {% if pos.current_price %}
                                    {{ "%.2f"|format(pos.current_price) }} ‚ÇΩ
                                {% else %}
                                    <span style="color: #999;">‚Äî</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if pos.current_profit is not none %}
                                    <span class="{% if pos.current_profit > 0 %}positive{% else %}negative{% endif %}">
                                        {% if pos.current_profit > 0 %}+{% endif %}{{ "%.2f"|format(pos.current_profit) }}%
                                    </span>
                                {% else %}
                                    <span style="color: #999;">‚Äî</span>
                                {% endif %}
                            </td>
                            <td>{{ pos.entry_time.strftime("%d.%m.%Y %H:%M") }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>
        {% endif %}

        <!-- –ë–ª–æ–∫: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∞–∫—Ü–∏—è–º - –í—Å–µ -->
        {% if ticker_stats_all %}
        <section class="ticker-stats">
            <h2>üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∞–∫—Ü–∏—è–º (–í—Å–µ, –∑–∞ –≤—Å—ë –≤—Ä–µ–º—è)</h2>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>–ê–∫—Ü–∏—è</th>
                            <th>–°–¥–µ–ª–æ–∫</th>
                            <th>–í–∏–Ω—Ä–µ–π—Ç</th>
                            <th>–û–±—â–∞—è –ø—Ä–∏–±—ã–ª—å</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for stat in ticker_stats_all %}
                        <tr>
                            <td>{{ stat.stock_emoji }} {{ stat.ticker }} - {{ stat.stock_name }}</td>
                            <td>{{ stat.total_trades }}</td>
                            <td>{{ "%.2f"|format(stat.winrate) }}%</td>
                            <td class="{% if stat.total_profit > 0 %}positive{% else %}negative{% endif %}">
                                {% if stat.total_profit > 0 %}+{% endif %}{{ "%.2f"|format(stat.total_profit) }}%
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>
        {% endif %}

        <!-- –ë–ª–æ–∫: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∞–∫—Ü–∏—è–º - LONG -->
        {% if ticker_stats_long %}
        <section class="ticker-stats">
            <h2>‚ÜóÔ∏è –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∞–∫—Ü–∏—è–º (LONG, –∑–∞ –≤—Å—ë –≤—Ä–µ–º—è)</h2>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>–ê–∫—Ü–∏—è</th>
                            <th>–°–¥–µ–ª–æ–∫</th>
                            <th>–í–∏–Ω—Ä–µ–π—Ç</th>
                            <th>–û–±—â–∞—è –ø—Ä–∏–±—ã–ª—å</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for stat in ticker_stats_long %}
                        <tr class="position-long-subtle">
                            <td>{{ stat.stock_emoji }} {{ stat.ticker }} - {{ stat.stock_name }}</td>
                            <td>{{ stat.total_trades }}</td>
                            <td>{{ "%.2f"|format(stat.winrate) }}%</td>
                            <td class="{% if stat.total_profit > 0 %}positive{% else %}negative{% endif %}">
                                {% if stat.total_profit > 0 %}+{% endif %}{{ "%.2f"|format(stat.total_profit) }}%
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>
        {% endif %}

        <!-- –ë–ª–æ–∫: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∞–∫—Ü–∏—è–º - SHORT -->
        {% if ticker_stats_short %}
        <section class="ticker-stats">
            <h2>‚ÜòÔ∏è –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∞–∫—Ü–∏—è–º (SHORT, –∑–∞ –≤—Å—ë –≤—Ä–µ–º—è)</h2>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>–ê–∫—Ü–∏—è</th>
                            <th>–°–¥–µ–ª–æ–∫</th>
                            <th>–í–∏–Ω—Ä–µ–π—Ç</th>
                            <th>–û–±—â–∞—è –ø—Ä–∏–±—ã–ª—å</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for stat in ticker_stats_short %}
                        <tr class="position-short-subtle">
                            <td>{{ stat.stock_emoji }} {{ stat.ticker }} - {{ stat.stock_name }}</td>
                            <td>{{ stat.total_trades }}</td>
                            <td>{{ "%.2f"|format(stat.winrate) }}%</td>
                            <td class="{% if stat.total_profit > 0 %}positive{% else %}negative{% endif %}">
                                {% if stat.total_profit > 0 %}+{% endif %}{{ "%.2f"|format(stat.total_profit) }}%
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>
        {% endif %}

        <!-- –ë–ª–æ–∫: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ - –í—Å–µ —Ç–∏–ø—ã -->
        <section class="additional-stats">
            <h2>üíé –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ (–∑–∞ –≤—Å—ë –≤—Ä–µ–º—è)</h2>
            
            <h3 style="margin-top: 20px; color: #667eea;">–í—Å–µ —Å–¥–µ–ª–∫–∏</h3>
            <div class="additional-cards">
                {% if best_trade_all %}
                <a href="/top-trades?type=best" class="card-link">
                    <div class="additional-card clickable">
                        <div class="card-title">üèÜ –õ—É—á—à–∞—è —Å–¥–µ–ª–∫–∞</div>
                        <div class="card-content">
                            <div class="card-main">{{ best_trade_all.stock_emoji }} {{ best_trade_all.ticker }}</div>
                            <div class="type-badge {% if best_trade_all.position_type == 'LONG' %}long-badge{% else %}short-badge{% endif %}">
                                {% if best_trade_all.position_type == 'LONG' %}‚ÜóÔ∏è LONG{% else %}‚ÜòÔ∏è SHORT{% endif %}
                            </div>
                            <div class="card-profit positive">+{{ "%.2f"|format(best_trade_all.profit_percent) }}%</div>
                            <div class="card-date">{{ best_trade_all.exit_time.strftime("%d.%m.%Y") }}</div>
                        </div>
                        <div class="card-hint">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è —Ç–æ–ø-10 ‚Üí</div>
                    </div>
                </a>
                {% endif %}

                {% if worst_trade_all %}
                <a href="/top-trades?type=worst" class="card-link">
                    <div class="additional-card clickable">
                        <div class="card-title">üìâ –•—É–¥—à–∞—è —Å–¥–µ–ª–∫–∞</div>
                        <div class="card-content">
                            <div class="card-main">{{ worst_trade_all.stock_emoji }} {{ worst_trade_all.ticker }}</div>
                            <div class="type-badge {% if worst_trade_all.position_type == 'LONG' %}long-badge{% else %}short-badge{% endif %}">
                                {% if worst_trade_all.position_type == 'LONG' %}‚ÜóÔ∏è LONG{% else %}‚ÜòÔ∏è SHORT{% endif %}
                            </div>
                            <div class="card-profit negative">{{ "%.2f"|format(worst_trade_all.profit_percent) }}%</div>
                            <div class="card-date">{{ worst_trade_all.exit_time.strftime("%d.%m.%Y") }}</div>
                        </div>
                        <div class="card-hint">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è —Ç–æ–ø-10 ‚Üí</div>
                    </div>
                </a>
                {% endif %}

                <div class="additional-card">
                    <div class="card-title">‚è±Ô∏è –°—Ä–µ–¥–Ω—è—è –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</div>
                    <div class="card-content">
                        <div class="card-main-large">{{ avg_duration_all }}</div>
                    </div>
                </div>
            </div>

            <h3 style="margin-top: 30px; color: #11998e;">LONG —Å–¥–µ–ª–∫–∏</h3>
            <div class="additional-cards">
                {% if best_trade_long %}
                <a href="/top-trades?type=best&position_type=LONG" class="card-link">
                    <div class="additional-card clickable long-card-border">
                        <div class="card-title">üèÜ –õ—É—á—à–∞—è LONG</div>
                        <div class="card-content">
                            <div class="card-main">{{ best_trade_long.stock_emoji }} {{ best_trade_long.ticker }}</div>
                            <div class="card-profit positive">+{{ "%.2f"|format(best_trade_long.profit_percent) }}%</div>
                            <div class="card-date">{{ best_trade_long.exit_time.strftime("%d.%m.%Y") }}</div>
                        </div>
                        <div class="card-hint">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è —Ç–æ–ø-10 LONG ‚Üí</div>
                    </div>
                </a>
                {% endif %}

                {% if worst_trade_long %}
                <a href="/top-trades?type=worst&position_type=LONG" class="card-link">
                    <div class="additional-card clickable long-card-border">
                        <div class="card-title">üìâ –•—É–¥—à–∞—è LONG</div>
                        <div class="card-content">
                            <div class="card-main">{{ worst_trade_long.stock_emoji }} {{ worst_trade_long.ticker }}</div>
                            <div class="card-profit negative">{{ "%.2f"|format(worst_trade_long.profit_percent) }}%</div>
                            <div class="card-date">{{ worst_trade_long.exit_time.strftime("%d.%m.%Y") }}</div>
                        </div>
                        <div class="card-hint">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è —Ç–æ–ø-10 LONG ‚Üí</div>
                    </div>
                </a>
                {% endif %}

                <div class="additional-card long-card-border">
                    <div class="card-title">‚è±Ô∏è –°—Ä–µ–¥–Ω—è—è LONG</div>
                    <div class="card-content">
                        <div class="card-main-large">{{ avg_duration_long }}</div>
                    </div>
                </div>
            </div>

            <h3 style="margin-top: 30px; color: #ee0979;">SHORT —Å–¥–µ–ª–∫–∏</h3>
            <div class="additional-cards">
                {% if best_trade_short %}
                <a href="/top-trades?type=best&position_type=SHORT" class="card-link">
                    <div class="additional-card clickable short-card-border">
                        <div class="card-title">üèÜ –õ—É—á—à–∞—è SHORT</div>
                        <div class="card-content">
                            <div class="card-main">{{ best_trade_short.stock_emoji }} {{ best_trade_short.ticker }}</div>
                            <div class="card-profit positive">+{{ "%.2f"|format(best_trade_short.profit_percent) }}%</div>
                            <div class="card-date">{{ best_trade_short.exit_time.strftime("%d.%m.%Y") }}</div>
                        </div>
                        <div class="card-hint">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è —Ç–æ–ø-10 SHORT ‚Üí</div>
                    </div>
                </a>
                {% endif %}

                {% if worst_trade_short %}
                <a href="/top-trades?type=worst&position_type=SHORT" class="card-link">
                    <div class="additional-card clickable short-card-border">
                        <div class="card-title">üìâ –•—É–¥—à–∞—è SHORT</div>
                        <div class="card-content">
                            <div class="card-main">{{ worst_trade_short.stock_emoji }} {{ worst_trade_short.ticker }}</div>
                            <div class="card-profit negative">{{ "%.2f"|format(worst_trade_short.profit_percent) }}%</div>
                            <div class="card-date">{{ worst_trade_short.exit_time.strftime("%d.%m.%Y") }}</div>
                        </div>
                        <div class="card-hint">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è —Ç–æ–ø-10 SHORT ‚Üí</div>
                    </div>
                </a>
                {% endif %}

                <div class="additional-card short-card-border">
                    <div class="card-title">‚è±Ô∏è –°—Ä–µ–¥–Ω—è—è SHORT</div>
                    <div class="card-content">
                        <div class="card-main-large">{{ avg_duration_short }}</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- –ë–ª–æ–∫: –õ–µ–Ω—Ç–∞ –≤—Å–µ—Ö —Å–¥–µ–ª–æ–∫ -->
        {% if closed_positions %}
        <section class="trades-feed">
            <h2>üìú –õ–µ–Ω—Ç–∞ —Å–¥–µ–ª–æ–∫ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ {{ closed_positions|length }})</h2>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>–î–∞—Ç–∞ –∑–∞–∫—Ä—ã—Ç–∏—è</th>
                            <th>–ê–∫—Ü–∏—è</th>
                            <th>–¢–∏–ø</th>
                            <th>–ü—Ä–∏–±—ã–ª—å</th>
                            <th>–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for pos in closed_positions %}
                        <tr class="{% if pos.position_type == 'LONG' %}position-long-subtle{% else %}position-short-subtle{% endif %}">
                            <td>{{ pos.exit_time.strftime("%d.%m.%Y %H:%M") }}</td>
                            <td>{{ pos.stock_emoji }} {{ pos.ticker }} - {{ pos.stock_name }}</td>
                            <td>
                                {% if pos.position_type == 'LONG' %}
                                    <span class="type-badge long-badge">‚ÜóÔ∏è LONG</span>
                                {% else %}
                                    <span class="type-badge short-badge">‚ÜòÔ∏è SHORT</span>
                                {% endif %}
                            </td>
                            <td class="{% if pos.profit_percent > 0 %}positive{% else %}negative{% endif %}">
                                {% if pos.profit_percent > 0 %}+{% endif %}{{ "%.2f"|format(pos.profit_percent) }}%
                            </td>
                            <td>{{ pos.duration_str }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>
        {% else %}
        <section class="trades-feed">
            <h2>üìú –õ–µ–Ω—Ç–∞ —Å–¥–µ–ª–æ–∫</h2>
            <p class="no-data">–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫—Ä—ã—Ç—ã—Ö —Å–¥–µ–ª–æ–∫</p>
        </section>
        {% endif %}

        <footer>
            <p>¬© 2025 –†–µ–≤—É—â–∏–π –∫–æ—Ç—ë–Ω–æ–∫ üê± | –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</p>
        </footer>
    </div>

    <script>
        function changeMonth(value) {
            const [year, month] = value.split('-');
            window.location.href = `/?year=${year}&month=${month}`;
        }
    </script>
</body>
</html>
